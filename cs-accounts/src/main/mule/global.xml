<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:wsc="http://www.mulesoft.org/schema/mule/wsc"
	xmlns:accounts-api="http://www.mulesoft.org/schema/mule/accounts-api" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd 
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/accounts-api http://www.mulesoft.org/schema/mule/accounts-api/current/mule-accounts-api.xsd
http://www.mulesoft.org/schema/mule/wsc http://www.mulesoft.org/schema/mule/wsc/current/mule-wsc.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="2b299bf7-2de1-4f92-aa0d-5b818647c488" >
		<http:listener-connection host="0.0.0.0" port="${http.port}" />
	</http:listener-config>
	<http:request-config name="HTTP_Request_configuration" doc:name="HTTP Request configuration" doc:id="a2e596d5-0f9a-426a-afaa-77531978a8a4" >
		<http:request-connection host="${database.host}" port="${database.port}" />
	</http:request-config>
	<vm:config name="VM_Config" doc:name="VM Config" doc:id="b837b64b-98eb-4c78-8123-e80ae6d4d28f" >
		<vm:queues >
			<vm:queue queueName="postAccount" />
		</vm:queues>
	</vm:config>
	<configuration-properties doc:name="Configuration properties" doc:id="e65d0487-570d-419d-94d4-1787a841d02a" file="config.yaml" />
	<accounts-api:config name="Accounts_API_Config" doc:name="Accounts API Config" doc:id="b36a8ae9-31ca-42a3-b5dc-9e2993653f12" property_host="${database.host}" property_port="${database.port}" property_protocol="${database.protocol}" property_basePath="${database.basepath}" />
	<wsc:config name="Web_Service_Consumer_Config" doc:name="Web Service Consumer Config" doc:id="122e1a6e-981c-4b47-8852-2a82bedb9e32" >
		<wsc:connection wsdlLocation="${trans.wsdl}" service="${trans.service}" port="${trans.port}" address="${trans.address}" >
			<wsc:web-service-security actor="http://schemas.xmlsoap.org/soap/actor/next" />
		</wsc:connection>
	</wsc:config>
	<error-handler name="validation_Handler" doc:id="31317712-0344-4660-b6be-ed9b189f2e4f" >
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="368d177b-cd45-4744-801b-25b7924de12a" type="APP:CONDITION">
			<ee:transform doc:name="invalid condition" doc:id="1678555f-9592-49b1-9eac-4d49d88c2727" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
message: error.description,
condition: vars.cond
}]]></ee:set-payload>
				</ee:message>
			</ee:transform>
			<set-variable value="400" doc:name="httpStatus" doc:id="1ce8d50e-db3c-4a00-9376-5ea74d8a4e9f" variableName="httpStatus"/>
		</on-error-propagate>
		<on-error-propagate enableNotifications="true" logException="true" doc:name="Copy_of_On Error Propagate" doc:id="24bdcbdf-c58a-422c-a0da-7cf9671b92f6" type="APP:ACCOUNTTYPE" >
			<ee:transform doc:name="invalid account type" doc:id="cc2c19cc-d343-455d-9780-915b0a37ac6f" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
message: error.description,
account_type: vars.accounttype
}]]></ee:set-payload>
				</ee:message>
			</ee:transform>
			<set-variable value="400" doc:name="httpStatus" doc:id="11a6f2fa-3028-4d3a-bc72-7a8d9b123366" variableName="httpStatus" />
		</on-error-propagate>
	</error-handler>
	<error-handler name="other_Handler" doc:id="e7ce8bb0-255a-4132-91a4-86b79fda13c8" >
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="8b531d93-ca95-40aa-9ef5-d3df95c33fdd" >
			<ee:transform doc:name="contact admin" doc:id="8f7fa8c7-b941-42af-9da8-b72b7c105b11" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
message: "Please contact the application's admin/owner."
}]]></ee:set-payload>
				</ee:message>
			</ee:transform>
		</on-error-propagate>
	</error-handler>
	
	
	
</mule>
