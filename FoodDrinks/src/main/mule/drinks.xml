<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="searchCocktailsByName" doc:id="aa772b6d-f16c-4847-827d-47a3bf1df3b4" >
		<set-variable value="#[attributes.queryParams.cocktailByName]" doc:name="cocktailByName" doc:id="8a011b6e-ee6f-49ba-8542-e4763147aee3" variableName="cocktailByName" />
		<http:request method="GET" doc:name="GET /cocktailsByName" doc:id="380c82d9-01fd-45b9-9d5d-1ba165d99b28" config-ref="HTTP_Request_drinks_configuration" path="/search.php" >
			<http:query-params ><![CDATA[#[output application/java
---
{
	"s" : vars.cocktailByName
}]]]></http:query-params>
		</http:request>
		<ee:transform doc:name="data to JSON" doc:id="42281178-aa06-41bb-be52-705f2ac1bba8" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
fun findKey(key)
= key match {
  case is String -> key
  else -> "null"
}
---
drinks: payload.drinks map ( drink , indexOfDrink ) -> {
		"idDrink": drink.idDrink,
		"name": drink.strDrink,
		"DrinkAlternate": drink.strDrinkAlternate,
		"Tags": drink.strTags,
		"Video": drink.strVideo,
		"Category": drink.strCategory,
		"IBA": drink.strIBA,
		"Alcoholic": drink.strAlcoholic,
		"Glass": drink.strGlass,
		"Instructions": drink.strInstructions,
		"Ingredients": {
			(findKey(drink.strIngredient1)): drink.strMeasure1,
			(findKey(drink.strIngredient2)): drink.strMeasure2,
			(findKey(drink.strIngredient3)): drink.strMeasure3,	
			(findKey(drink.strIngredient4)): drink.strMeasure4,
			(findKey(drink.strIngredient5)): drink.strMeasure5,
			(findKey(drink.strIngredient6)): drink.strMeasure6,	
			(findKey(drink.strIngredient7)): drink.strMeasure7
		},
		"ImageSource": drink.strImageSource,
		"ImageAttribution": drink.strImageAttribution,
		"CreativeCommonsConfirmed": drink.strCreativeCommonsConfirmed
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Logger" doc:id="cd74031b-1d06-456d-9d36-3f06fb93238e" />
	</sub-flow>
	<sub-flow name="categoryCocktails" doc:id="7ced9d43-a9e2-4176-92e7-7fefb155455c" >
		<set-variable value="#[message.attributes.queryParams.category]" doc:name="category" doc:id="a025f58c-591c-4111-9cf9-b92d78f19351" variableName="category" />
		<http:request method="GET" doc:name="GET /CocktailsbyCategory" doc:id="6d220a33-3d70-490e-8647-2fd51bf15c79" config-ref="HTTP_Request_drinks_configuration" path="/filter.php" >
			<http:query-params ><![CDATA[#[output application/java
---
{
	"c" : vars.category
}]]]></http:query-params>
		</http:request>
	</sub-flow>
	<sub-flow name="listOfAllCocktails" doc:id="8b8a26e7-e204-4782-b08a-edcbb40a4c32" >
		<logger level="INFO" doc:name="Logger" doc:id="ef72f982-c5c2-4397-b1a4-767c361417b5" />
		<set-variable value='#[["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"]]' doc:name="alfabet(A-Z)" doc:id="42174e90-4805-4422-aa56-16babf86b8fd" variableName="AZ" />
		<set-variable value="#[[]]" doc:name="varsLetter" doc:id="8677bdb2-399c-4e3d-9ef4-cd45f0f410cd" variableName="varsLetter" />
		<foreach doc:name="For Each Alfabet" doc:id="c6c05d44-0898-462d-9ab0-dcbf2928e5e5" collection="#[vars.AZ]" >
			<logger level="INFO" doc:name="Logger" doc:id="530f62e8-3eac-45ab-9c9d-5210e3924813" />
			<http:request method="GET" doc:name="GET /listCocktails" doc:id="f0882197-2646-45db-9dfe-7fc85e00cb5e" config-ref="HTTP_Request_drinks_configuration" path="/search.php" >
				<http:query-params ><![CDATA[#[output application/java
---
{
	"f" : payload
}]]]></http:query-params>
			</http:request>
			<ee:transform doc:name="payload" doc:id="4294d8d0-fb45-4fee-9a7a-23cdda93cc85" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0 
output application/json 
--- 
payload]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="varsLetter" ><![CDATA[%dw 2.0
output application/java
---
vars.varsLetter + payload]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
		</foreach>
		<ee:transform doc:name="varsletter" doc:id="fcb7f0f6-5145-42f2-9220-bfd6c740becb" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
vars.varsLetter]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<ee:transform doc:name="collectInOneList" doc:id="8402364c-c541-4ae4-8ef7-057a11a2f346" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
flatten(payload.drinks)]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Logger" doc:id="0adceb81-71a7-4e32-bc29-25964bea8dc1" />
	</sub-flow>
	<sub-flow name="randomCoctail" doc:id="d9131e04-4f4e-494a-8d02-661073c3db50" >
		<http:request method="GET" doc:name="GET /randomCoctail" doc:id="d911bf9d-5d9e-4745-ae55-0b9e3b7c339c" config-ref="HTTP_Request_drinks_configuration" path="/random.php" />
		<logger level="INFO" doc:name="Logger" doc:id="c1132de9-8d49-4aa6-ae88-5be1782d7df2" />
	</sub-flow>
	<sub-flow name="ingridients" doc:id="f77ad222-5cbf-4213-ba1e-4ee95ada0691" >
		<set-variable value="#[message.attributes.queryParams.ingridient]" doc:name="ingridient" doc:id="5342b1c4-ddae-463a-a741-c932162dec5f" variableName="ingridient" />
		<http:request method="GET" doc:name="GET /ingridient" doc:id="59cd0483-9411-41b5-82ce-c7665ae39018" config-ref="HTTP_Request_drinks_configuration" path="/filter.php" >
			<http:query-params ><![CDATA[#[output application/java
---
{
	"i" : vars.ingridient
}]]]></http:query-params>
		</http:request>
		<ee:transform doc:name="listOfAllIngredient" doc:id="14a2c65f-f0ab-4c6b-a911-a96267de4524" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
flatten(payload.drinks.strIngredient1)]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
	<sub-flow name="recipe" doc:id="4031a47f-146f-485c-97fa-6672d3e36cc4" >
		<flow-ref doc:name="searchCocktailsByName" doc:id="f38db36d-7949-49f4-abdf-3aa6eb3b69ad" name="searchCocktailsByName" />
		<logger level="INFO" doc:name="Logger" doc:id="d333e9b7-cc02-471f-9aad-811807bcadd0" />
		<ee:transform doc:name="ingridient and measure" doc:id="280ae952-20b5-44ea-b9fa-845c639afce7" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
fun findKey(key)
= key match {
  case is String -> key
  else -> "null"
}
---

	drinks: payload.drinks map ( drink , indexOfDrink ) -> {
		"name": drink.strDrink,
		"Ingredients": {
			(findKey(drink.strIngredient1)): drink.strMeasure1,
			(findKey(drink.strIngredient2)): drink.strMeasure2,
			(findKey(drink.strIngredient3)): drink.strMeasure3,	
			(findKey(drink.strIngredient4)): drink.strMeasure4,
			(findKey(drink.strIngredient5)): drink.strMeasure5,
			(findKey(drink.strIngredient6)): drink.strMeasure6,	
			(findKey(drink.strIngredient7)): drink.strMeasure7
		}
		
		
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="logger" doc:id="fb6ffa0d-13b7-4559-8355-dcbd2ebd1856" />
	</sub-flow>

</mule>
